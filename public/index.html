<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Suite - Social Media Integration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-analytics.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">Dragon Suite</h1>
            <p class="text-lg text-gray-600">Social Media Integration Dashboard</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Personal Account -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-semibold mb-6">@thereal.mendes</h2>
                
                <!-- Instagram -->
                <div class="account-section mb-6" data-account="THEREAL_MENDES" data-platform="instagram">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-medium">Instagram Reels</h3>
                        <a href="/auth/instagram/init/THEREAL_MENDES" class="connect-button bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded">Connect Account</a>
                    </div>
                    <div id="thereal_mendes-instagram-status" class="text-sm"></div>
                </div>

                <!-- YouTube -->
                <div class="account-section mb-6" data-account="THEREAL_MENDES" data-platform="youtube">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-medium">YouTube Shorts</h3>
                        <a href="/auth/youtube/init/THEREAL_MENDES" class="connect-button bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">Connect Account</a>
                    </div>
                    <div id="thereal_mendes-youtube-status" class="text-sm"></div>
                </div>

                <!-- TikTok -->
                <div class="account-section mb-6" data-account="THEREAL_MENDES" data-platform="tiktok">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-medium">TikTok</h3>
                        <a href="/auth/tiktok/init/THEREAL_MENDES" class="connect-button bg-black hover:bg-gray-800 text-white px-4 py-2 rounded">Connect Account</a>
                    </div>
                    <div id="thereal_mendes-tiktok-status" class="text-sm"></div>
                </div>
            </div>

            <!-- Charity Account -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-semibold mb-6">@algarviocharity</h2>
                
                <!-- Instagram -->
                <div class="account-section mb-6" data-account="ALGARVIOCHARITY" data-platform="instagram">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-medium">Instagram Reels</h3>
                        <a href="/auth/instagram/init/ALGARVIOCHARITY" class="connect-button bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded">Connect Account</a>
                    </div>
                    <div id="algarviocharity-instagram-status" class="text-sm"></div>
                </div>

                <!-- YouTube -->
                <div class="account-section mb-6" data-account="ALGARVIOCHARITY" data-platform="youtube">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-medium">YouTube Shorts</h3>
                        <a href="/auth/youtube/init/ALGARVIOCHARITY" class="connect-button bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">Connect Account</a>
                    </div>
                    <div id="algarviocharity-youtube-status" class="text-sm"></div>
                </div>

                <!-- TikTok -->
                <div class="account-section mb-6" data-account="ALGARVIOCHARITY" data-platform="tiktok">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-medium">TikTok</h3>
                        <a href="/auth/tiktok/init/ALGARVIOCHARITY" class="connect-button bg-black hover:bg-gray-800 text-white px-4 py-2 rounded">Connect Account</a>
                    </div>
                    <div id="algarviocharity-tiktok-status" class="text-sm"></div>
                </div>
            </div>
        </div>

        <!-- Upload Form -->
        <div class="mt-12 bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-semibold mb-6">Upload Video</h2>
            <form id="uploadForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Video File</label>
                    <input type="file" accept="video/*" required class="mt-1 block w-full" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Caption</label>
                    <input type="text" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" />
                </div>
                <div class="flex space-x-4">
                    <button type="submit" class="upload-button bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded">
                        Upload to All Platforms
                    </button>
                    <div id="upload-status" class="text-sm"></div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            // Your Firebase config here
        };
        firebase.initializeApp(firebaseConfig);
        const analytics = firebase.analytics();

        // Handle URL parameters for auth callbacks
        const urlParams = new URLSearchParams(window.location.search);
        const account = urlParams.get('account');
        const platform = urlParams.get('platform');
        const success = urlParams.get('success');
        const error = urlParams.get('error');

        if (account && platform) {
            const statusDiv = document.getElementById(`${account.toLowerCase()}-${platform}-status`);
            if (success) {
                statusDiv.textContent = 'Successfully connected!';
                statusDiv.className = 'text-sm text-green-600';
                localStorage.setItem(`${platform}_${account}_connected`, 'true');
                analytics.logEvent('social_account_connected', { account, platform });
            } else if (error) {
                statusDiv.textContent = decodeURIComponent(error);
                statusDiv.className = 'text-sm text-red-600';
                analytics.logEvent('social_account_error', { account, platform, error });
            }
        }

        // Handle form submission
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const uploadStatus = document.getElementById('upload-status');
            const file = e.target.querySelector('input[type="file"]').files[0];
            const caption = e.target.querySelector('input[type="text"]').value;

            try {
                uploadStatus.textContent = 'Uploading...';
                uploadStatus.className = 'text-sm text-blue-600';

                // Create object URL for the video file
                const videoUrl = URL.createObjectURL(file);

                // Upload to all connected platforms for both accounts
                const accounts = ['THEREAL_MENDES', 'ALGARVIOCHARITY'];
                const platforms = ['instagram', 'youtube', 'tiktok'];
                
                for (const account of accounts) {
                    for (const platform of platforms) {
                        if (localStorage.getItem(`${platform}_${account}_connected`) === 'true') {
                            try {
                                const response = await fetch(`/${platform}/video/${account}`, {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({ videoUrl, caption })
                                });

                                const result = await response.json();
                                const statusDiv = document.getElementById(`${account.toLowerCase()}-${platform}-status`);
                                
                                if (result.success) {
                                    statusDiv.textContent = 'Upload successful!';
                                    statusDiv.className = 'text-sm text-green-600';
                                    analytics.logEvent('video_upload_success', { account, platform });
                                } else {
                                    throw new Error(result.error);
                                }
                            } catch (error) {
                                const statusDiv = document.getElementById(`${account.toLowerCase()}-${platform}-status`);
                                statusDiv.textContent = `Upload failed: ${error.message}`;
                                statusDiv.className = 'text-sm text-red-600';
                                analytics.logEvent('video_upload_error', { account, platform, error: error.message });
                            }
                        }
                    }
                }

                uploadStatus.textContent = 'All uploads completed!';
                uploadStatus.className = 'text-sm text-green-600';
            } catch (error) {
                uploadStatus.textContent = `Upload failed: ${error.message}`;
                uploadStatus.className = 'text-sm text-red-600';
                analytics.logEvent('video_upload_error', { error: error.message });
            }
        });

        // Update UI based on connection status
        function updateConnectionStatus() {
            const accounts = ['THEREAL_MENDES', 'ALGARVIOCHARITY'];
            const platforms = ['instagram', 'youtube', 'tiktok'];

            for (const account of accounts) {
                for (const platform of platforms) {
                    const isConnected = localStorage.getItem(`${platform}_${account}_connected`) === 'true';
                    const section = document.querySelector(`.account-section[data-account="${account}"][data-platform="${platform}"]`);
                    const button = section.querySelector('.connect-button');
                    const statusDiv = document.getElementById(`${account.toLowerCase()}-${platform}-status`);

                    if (isConnected) {
                        button.textContent = 'Connected';
                        button.disabled = true;
                        statusDiv.textContent = 'Successfully connected!';
                        statusDiv.className = 'text-sm text-green-600';
                    }
                }
            }
        }

        // Update status on page load
        updateConnectionStatus();
    </script>
</body>
</html>
